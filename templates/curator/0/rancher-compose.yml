version: '2'
catalog:
  name: "Curator"
  version: "5.1"
  description: "Curator"
  questions:
    - variable: "CRON_SCHEDULE"
      description: "The schedule with the Go cron syntaxe (per default, each day)"
      label: "Schedule"
      type: "string"
      required: true
      default: "0 20 5 * * ?"
    - variable: "curator_actions"
      description: |
        Logstash collection tier inputs. These will be added
        directly to input { } section of logstash.conf
      label: "Curator actions"
      type: "multiline"
      required: true
      default: |
        ---
        # Remember, leave a key empty if there is no value.  None will be a string,
        # not a Python "NoneType"
        #
        # Also remember that all examples have 'disable_action' set to True.  If you
        # want to use this action as a template, be sure to set this to False after
        # copying it.
        actions:
          1:
            action: snapshot
            description: >-
              Snapshot logstash- prefixed indices older than 1 day (based on index
              creation_date) with the default snapshot name pattern of
              'curator-%Y%m%d%H%M%S'.  Wait for the snapshot to complete.  Do not skip
              the repository filesystem access check.  Use the other options to create
              the snapshot.
            options:
              repository: vg-es-index-backups
              # Leaving name blank will result in the default 'curator-%Y%m%d%H%M%S'
              name: curator-%Y%m%d%H%M%S
              ignore_unavailable: True
              include_global_state: True
              partial: False
              wait_for_completion: True
              skip_repo_fs_check: False
              timeout_override:
              continue_if_exception: False
              disable_action: False
            filters:
            - filtertype: pattern
              kind: prefix
              value: logstash-
              exclude:
            - filtertype: age
              source: creation_date
              direction: older
              unit: days
              unit_count: 1
              exclude:
          2:
            action: delete_indices
            description: >-
              Delete indices older than 6 days (based on index name), for logstash-
              prefixed indices. Ignore the error if the filter does not result in an
              actionable list of indices (ignore_empty_list) and exit cleanly.
            options:
              ignore_empty_list: True
              timeout_override:
              continue_if_exception: False
              disable_action: False
            filters:
            - filtertype: pattern
              kind: prefix
              value: logstash-
              exclude:
            - filtertype: age
              source: name
              direction: older
              timestring: '%Y.%m.%d'
              unit: days
              unit_count: 7
              exclude:

    - variable: "elasticsearch_link"
      description: |
        stack/service link or external service link to elasticsearch
        cluster.
      label: "Elasticsearch stack/service"
      default: "es-cluster/es-master"
      required: true
      type: "service"
services:
  curator-cronjob:
    metadata:
      actions: |
        ${curator_actions}
